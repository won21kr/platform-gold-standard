.container
  = render 'layouts/sidenav'
  .row
    .index-banner.section.no-pad-bot
  .row
    .col.m12.l10.push-l2{:style => "margin-top: 25px;"}
      // Title
      .col.s12
        %h3.thin{:style => "margin-top: 40px; font-size: 28px; letter-spacing: 1.5px; text-color: #002557;"}
          %i.material-icons.prefix{:style => "font-size: 28px;"} email
          = alt_text("Message Center")

      -# Messages
      .col.s3.message-tabs
        %a.btn.white.black-text{:href => "/compose-message"} Compose

        .row
          .col.s9
            %h6.col.s9 Inbox
            %h6.col.s2 0
          .col.s9.sent-selected
            %h6.col.s9 Sent
            %h6.col.s2
              = @sentMessages.size
          .col.s9
            %h6.col.s9 Deleted
            %h6.col.s2 0

      -# Display message thread
      .col.s9
        .col.s12{:style => "margin-top: 20px"}
          %h5
            = "Subject: " + @message.name
          %div{:style => "margin-bottom: 40px"}
            Collaborators:
            - @collaborators.each do |collaborator|
              = collaborator.accessible_by.name
          %h6 Message Thread
          %ul
            - @messageThread.each do |m|
              %li{:style => "margin-bottom: 10px"}
                .commenterImage
                  - if (m.created_by.id == ENV['EMPL_ID'])
                    = image_tag "empl.png"
                  - else
                    = image_tag "new_user.png"
                .commentText
                  %p
                    = m.message
                  %span.date.sub-text
                    - if (m.created_by.id == ENV['EMPL_ID'])
                      = m.created_by.login + ", " + DateTime.strptime(m.created_at).strftime("%m/%d/%y at %l:%M %p")
                    - else
                      = m.created_by.name + ", " + DateTime.strptime(m.created_at).strftime("%m/%d/%y at %l:%M %p")


          / allow user to submit message
          %form.form-inline{:role => "form", :action => post_message_path(messageId: @message.id, threadFileId: @messageThreadFile.id), :method => "post"}
            .commentbox
              %label{:for => "message", :style => "left: 0"} Add a message
              %textarea.input{:style => "width: 100%; height: 100%; background-color: #fff;", :rows => "4", :cols => "50", :name => "message", :required => true}
            .form-group{:style => "margin-bottom: 30px"}
              %button.btn.white.black-text{:style => "margin-top: 5px"} Post

        .col.s12{:style => "margin-top: 20px"}
          %table{:style => "margin-bottom: 50px"}
            %thead
              %h6 File Attachments
            %tbody
              - if @files.size == 0
                %tr
                  %td
                    %span
                      %i.material-icons error
                      No current attachments exist in this folder
              - else
                - @files.each do |file, i|
                  - unless file.name == "Messages.txt"
                    %tr{"data-lity" => "", :href => preview_url(file.id), :class => "tooltipped", 'data-position'=>"left", 'data-delay'=>"50", 'data-tooltip'=>"View"}
                      %td{"data-intro" => i==0 ? "Each of these documents are viewable in the browser via the Box Preview endpoint" : nil,  "data-position" => i==0 ? "left" : nil}
                        = image_tag(thumbnail_url(file.id), :width => "40px")
                      %td
                        .name_elipses
                          = file.name
          %div
            %a{:href => "/messaging-system", :style => "text-decoration: none; color: #333333"}
              Back to messages
